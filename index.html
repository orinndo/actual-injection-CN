<!doctype html>
<html lang="zh-Hans">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>拍摄正式检查（主扫描）语音指南</title>
<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Segoe UI",sans-serif;
background:linear-gradient(180deg,#f7fbff,#eef6ff);color:#0f172a;}
.header{padding:18px 16px 10px;}
.frame-title{border:2px solid #38bdf8;padding:14px 16px;border-radius:14px;background:#f8fcff;text-align:center;}
.frame-title h1{margin:0;font-size:20px;}
.frame-title p{margin:6px 0 0;font-size:14px;color:#475569;}
.note{font-size:12px;color:#475569;margin:12px 16px;}
.main{margin:0 16px 24px;padding:16px;background:#fff;border-radius:18px;box-shadow:0 8px 18px rgba(15,23,42,.08);}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
select{flex:1;max-width:100%;font-size:16px;padding:10px 36px 10px 12px;border-radius:12px;border:1px solid #cbd5f5;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
button{font-size:15px;padding:10px 14px;border-radius:12px;border:1px solid #cbd5f5;background:#eff6ff;}
button:active{transform:scale(.98);}
.label{margin-top:14px;font-size:13px;color:#475569;}
.jp{font-size:18px;font-weight:600;margin-top:6px;}
.en{font-size:16px;margin-top:4px;}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px;}
audio{width:100%;margin-top:10px;}
.status{margin-top:8px;font-size:13px;color:#475569;}
.hint{margin-top:10px;font-size:12px;color:#64748b;}

/* === Emergency Button (Main Scan only) === */
.fab-emg{
  position:fixed;right:16px;bottom:16px;z-index:10000;
  background:#fff1f2;border:1px solid #fecaca;color:#9f1239;
  border-radius:999px;padding:12px 14px;font-weight:800
}
.emg-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:9998;display:none}
.emg-sheet{position:fixed;left:0;right:0;bottom:0;z-index:9999;display:none;padding:12px}
.emg-panel{max-width:720px;margin:0 auto;background:#fff;border-radius:18px;padding:14px;
  box-shadow:0 18px 36px rgba(15,23,42,.22);}
.emg-item{border:1px solid #e2e8f0;border-radius:14px;padding:10px;margin-bottom:8px;cursor:pointer}
.emg-jp{font-weight:700;font-size:16px;line-height:1.35}
.emg-zh{font-size:14px;color:#0f172a;line-height:1.35;margin-top:4px}
.emg-tip{font-size:12px;color:#475569;margin:6px 0 10px}
.emg-close{font-size:14px;padding:10px 12px;border-radius:12px;border:1px solid #cbd5f5;background:#eff6ff}

</style>
</head>
<body>
<div class="header">
  <div class="frame-title">
    <h1>撮影本番（主扫描）</h1>
    <p>中文语音指南</p>
  </div>
</div>

<p class="note">※ iPhone / iPad / Android で再生できます。最初は「再生」を押してください。</p>

<div class="main">
  <div class="row">
    <select id="sel"></select>
    <button id="prev">← 前</button>
    <button id="next">次 →</button>
  </div>

  <div class="label">日本語（内容）</div>
  <div class="jp" id="jp"></div>

  <div class="label">中文（脚本）</div>
  <div class="en" id="en"></div>

  <div class="controls">
    <button id="play">▶︎ 再生</button>
    <button id="pause">⏸ 一時停止</button>
    <button id="replay">↻ もう一度</button>
  </div>

  <div class="status" id="status">待機中 / 准备就绪</div>
  <audio id="player" controls></audio>

  <div class="hint">
    再生できない場合：消音モード解除、音量、Bluetooth接続を確認してください。
  </div>
</div>


<button class="fab-emg" id="emgOpen" type="button">⚠ 急変時確認</button>
<div class="emg-backdrop" id="emgBackdrop"></div>
<div class="emg-sheet" id="emgSheet">
  <div class="emg-panel">
    <div class="emg-tip"></div>
    <div id="emgList"></div>
    <audio id="emgPlayer" controls style="width:100%"></audio>
    <button class="emg-close" id="emgClose" type="button">閉じる</button>
  </div>
</div>

<script>
const STEPS = [
 {preview:"まもなく造影剤を注射します…", jp:"まもなく造影剤を注射します。", en:"我们即将注射造影剂。"},
 {preview:"気分が悪くなったら…", jp:"気分が悪くなったら、すぐに教えてください。", en:"如果感到不适，请立刻告诉我们。"},
 {preview:"今から注入を開始します…", jp:"今から注入を開始します。痛みはありませんか？気分はいかがですか？", en:"现在开始注射。有没有疼痛？感觉如何？"},
 {preview:"だんだん温かく感じます…", jp:"だんだん体が温かく感じてきます。", en:"您会逐渐感到身体发热。"},
 {preview:"息止めの合図の後…", jp:"息止めの合図が聞こえたら、すぐに撮影が始まります。", en:"听到屏气的指示后，扫描将立即开始。"},
 {preview:"約1分後に再度撮影…", jp:"約1分後に、もう一度撮影します。気分はいかがですか？", en:"大约一分钟后，我们会再次进行扫描。感觉如何？"},
 {preview:"温かい感じは数分で…", jp:"温かい感じは数分でおさまります。", en:"这种温热感会在几分钟内消失。"}
];

const sel=document.getElementById('sel'),
jp=document.getElementById('jp'),
en=document.getElementById('en'),
player=document.getElementById('player'),
status=document.getElementById('status');

STEPS.forEach((s,i)=>{
 const o=document.createElement('option');
 o.value=i;
 o.textContent=`${String(i+1).padStart(2,'0')}｜${s.jp}`;
 sel.appendChild(o);
});

let idx=0;
function load(i){
 idx=Math.max(0,Math.min(STEPS.length-1,i));
 sel.value=idx;
 jp.textContent=STEPS[idx].jp;
 en.textContent=STEPS[idx].en;
 player.src=`audio/step_${String(idx+1).padStart(2,'0')}.m4a`;
 status.textContent="待機中 / 准备就绪";
}
sel.onchange=()=>load(parseInt(sel.value));
document.getElementById('prev').onclick=()=>load(idx-1);
document.getElementById('next').onclick=()=>load(idx+1);
document.getElementById('play').onclick=()=>player.play();
document.getElementById('pause').onclick=()=>player.pause();
document.getElementById('replay').onclick=()=>{player.currentTime=0;player.play();}
player.onplay=()=>status.textContent="再生中 / 播放中";
player.onpause=()=>status.textContent="一時停止 / 已暂停";
player.onended=()=>status.textContent="待機中 / 准备就绪";
load(0);

document.addEventListener('DOMContentLoaded',()=>{
  // Emergency quick check (Chinese)
  const EMG=[
    {jp:'聞こえますか？意識ははっきりしていますか？', zh:'你能听到我说话吗？意识清楚吗？', a:'audio/emergency_01.m4a'},
    {jp:'息苦しさはありますか？', zh:'你呼吸困难吗？', a:'audio/emergency_02.m4a'},
    {jp:'どこか痒みはありますか？', zh:'你身上有发痒的地方吗？', a:'audio/emergency_03.m4a'},
    {jp:'めまいやふらつきはありますか？', zh:'你感到头晕或站不稳吗？', a:'audio/emergency_04.m4a'},
    {jp:'吐き気や、吐きそうな感じはありますか？', zh:'你恶心或想吐吗？', a:'audio/emergency_05.m4a'},
    {jp:'喉が締め付けられる感じ、または詰まる感じはありますか？', zh:'你喉咙觉得发紧，或者像被堵住一样吗？', a:'audio/emergency_06.m4a'}
  ];

  const open=document.getElementById('emgOpen');
  const back=document.getElementById('emgBackdrop');
  const sheet=document.getElementById('emgSheet');
  const list=document.getElementById('emgList');
  const player=document.getElementById('emgPlayer');
  const close=document.getElementById('emgClose');

  if(!open||!back||!sheet||!list||!player||!close) return;

  EMG.forEach((s,i)=>{
    const d=document.createElement('div'); d.className='emg-item';
    d.innerHTML=`<div class="emg-jp">${i+1}. ${s.jp}</div>
                 <div class="emg-zh">${s.zh}</div>`;
    d.onclick=()=>{ player.src=s.a; player.play(); };
    list.appendChild(d);
  });

  function show(){ back.style.display='block'; sheet.style.display='block'; }
  function hide(){ back.style.display='none'; sheet.style.display='none'; }

  open.onclick=show;
  back.onclick=hide;
  close.onclick=hide;
});

</script>
</body>
</html>
